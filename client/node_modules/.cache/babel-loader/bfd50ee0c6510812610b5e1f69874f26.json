{"ast":null,"code":"import _slicedToArray from \"/Users/robertfronczak/yellow-chat/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\n\nvar _this = this,\n    _jsxFileName = \"/Users/robertfronczak/yellow-chat/client/src/pages/Chat.js\";\n\n// App.js\nimport React, { useState, useEffect } from 'react';\nimport useSocket from 'use-socket.io-client';\nimport { useImmer } from 'use-immer';\nimport './index.css';\nimport Navy from '../components/Navy';\nimport { useParams } from \"react-router-dom\";\nimport { saveHistory } from \"../utils/APIHistory\";\n\nvar Messages = function Messages(props) {\n  return props.data.map(function (m) {\n    return m[0] !== '' ? /*#__PURE__*/React.createElement(\"li\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 12,\n        columnNumber: 62\n      }\n    }, /*#__PURE__*/React.createElement(\"strong\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 12,\n        columnNumber: 66\n      }\n    }, m[0]), \" : \", /*#__PURE__*/React.createElement(\"div\", {\n      className: \"innermsg\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 12,\n        columnNumber: 92\n      }\n    }, m[1])) : /*#__PURE__*/React.createElement(\"li\", {\n      className: \"update\",\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 12,\n        columnNumber: 140\n      }\n    }, m[1]);\n  });\n};\n\nvar Online = function Online(props) {\n  return props.data.map(function (m) {\n    return /*#__PURE__*/React.createElement(\"li\", {\n      id: m[0],\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 14,\n        columnNumber: 45\n      }\n    }, m[1]);\n  });\n};\n\nexport default function Chat() {\n  var _useState = useState(''),\n      _useState2 = _slicedToArray(_useState, 2),\n      id = _useState2[0],\n      setId = _useState2[1];\n\n  var _useState3 = useState(''),\n      _useState4 = _slicedToArray(_useState3, 2),\n      nameInput = _useState4[0],\n      setNameInput = _useState4[1];\n\n  var _useState5 = useState(''),\n      _useState6 = _slicedToArray(_useState5, 2),\n      room = _useState6[0],\n      setRoom = _useState6[1];\n\n  var _useState7 = useState(''),\n      _useState8 = _slicedToArray(_useState7, 2),\n      input = _useState8[0],\n      setInput = _useState8[1];\n\n  var _useSocket = useSocket('https://open-chat-naostsaecf.now.sh'),\n      _useSocket2 = _slicedToArray(_useSocket, 1),\n      socket = _useSocket2[0];\n\n  socket.connect();\n\n  var _useImmer = useImmer([]),\n      _useImmer2 = _slicedToArray(_useImmer, 2),\n      messages = _useImmer2[0],\n      setMessages = _useImmer2[1];\n\n  var _useImmer3 = useImmer([]),\n      _useImmer4 = _slicedToArray(_useImmer3, 2),\n      online = _useImmer4[0],\n      setOnline = _useImmer4[1]; //set room name based on props.match.params\n\n\n  var _useParams = useParams(),\n      vendorName = _useParams.vendorName;\n\n  console.log(\"!!!!!! \", vendorName); // on load, set room to be name of vendor, which came from useParams.\n\n  useEffect(function () {\n    setRoom(vendorName);\n  }, []); // loads page history into db\n\n  saveHistory({\n    historytype: \"Chat Page\",\n    username: vendorName,\n    detail: \"vendor name: \".concat(vendorName),\n    date: Date.now\n  }).then().catch(function (err) {\n    return console.log(err);\n  });\n  useEffect(function () {\n    socket.on('message que', function (nick, message) {\n      setMessages(function (draft) {\n        draft.push([nick, message]);\n      });\n    });\n    socket.on('update', function (message) {\n      return setMessages(function (draft) {\n        draft.push(['', message]);\n      });\n    });\n    socket.on('people-list', function (people) {\n      var newState = [];\n\n      for (var person in people) {\n        newState.push([people[person].id, people[person].nick]);\n      }\n\n      setOnline(function (draft) {\n        draft.push.apply(draft, newState);\n      });\n      console.log(online);\n    });\n    socket.on('add-person', function (nick, id) {\n      setOnline(function (draft) {\n        draft.push([id, nick]);\n      });\n    });\n    socket.on('remove-person', function (id) {\n      setOnline(function (draft) {\n        return draft.filter(function (m) {\n          return m[0] !== id;\n        });\n      });\n    });\n    socket.on('chat message', function (nick, message) {\n      setMessages(function (draft) {\n        draft.push([nick, message]);\n      });\n    });\n  }, 0);\n\n  var handleSubmit = function handleSubmit(e) {\n    e.preventDefault();\n\n    if (!nameInput) {\n      return alert(\"Name can't be empty\");\n    }\n\n    setId(nameInput);\n    socket.emit(\"join\", nameInput, room);\n  };\n\n  var handleSend = function handleSend(e) {\n    e.preventDefault();\n\n    if (input !== '') {\n      socket.emit('chat message', input, room);\n      setInput('');\n    }\n  };\n\n  return id ? /*#__PURE__*/React.createElement(\"section\", {\n    style: {\n      display: 'flex',\n      flexDirection: 'row'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"ul\", {\n    id: \"messages\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 103,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Messages, {\n    data: messages,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 103,\n      columnNumber: 25\n    }\n  })), /*#__PURE__*/React.createElement(\"ul\", {\n    id: \"online\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 104,\n      columnNumber: 7\n    }\n  }, \" \", /*#__PURE__*/React.createElement(\"span\", {\n    role: \"img\",\n    \"aria-label\": \"sheep\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 104,\n      columnNumber: 24\n    }\n  }, \"\\uD83C\\uDF10\"), \" : \", /*#__PURE__*/React.createElement(Online, {\n    data: online,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 104,\n      columnNumber: 72\n    }\n  }), \" \"), /*#__PURE__*/React.createElement(\"div\", {\n    id: \"sendform\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 105,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"form\", {\n    onSubmit: function onSubmit(e) {\n      return handleSend(e);\n    },\n    style: {\n      display: 'flex'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 106,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"input\", {\n    id: \"m\",\n    onChange: function onChange(e) {\n      return setInput(e.target.value.trim());\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 107,\n      columnNumber: 11\n    }\n  }), /*#__PURE__*/React.createElement(\"button\", {\n    style: {\n      width: '75px'\n    },\n    type: \"submit\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 107,\n      columnNumber: 75\n    }\n  }, \"Send\")))) :\n  /*#__PURE__*/\n  //(conditional rendereing here possibly)\n  React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 113,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Navy, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      textAlign: 'center',\n      margin: '30vh auto',\n      width: '70%'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 115,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"h2\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 117,\n      columnNumber: 11\n    }\n  }, \"Chat with \", room), /*#__PURE__*/React.createElement(\"form\", {\n    onSubmit: function onSubmit(event) {\n      return handleSubmit(event);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 120,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"input\", {\n    id: \"name\",\n    onChange: function onChange(e) {\n      return setNameInput(e.target.value.trim());\n    },\n    required: true,\n    placeholder: \"What is your name ..\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 122,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(\"br\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 122,\n      columnNumber: 128\n    }\n  }), /*#__PURE__*/React.createElement(\"button\", {\n    type: \"submit\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 124,\n      columnNumber: 13\n    }\n  }, \"Submit\"))));\n}\n;","map":{"version":3,"sources":["/Users/robertfronczak/yellow-chat/client/src/pages/Chat.js"],"names":["React","useState","useEffect","useSocket","useImmer","Navy","useParams","saveHistory","Messages","props","data","map","m","Online","Chat","id","setId","nameInput","setNameInput","room","setRoom","input","setInput","socket","connect","messages","setMessages","online","setOnline","vendorName","console","log","historytype","username","detail","date","Date","now","then","catch","err","on","nick","message","draft","push","people","newState","person","filter","handleSubmit","e","preventDefault","alert","emit","handleSend","display","flexDirection","target","value","trim","width","textAlign","margin","event"],"mappings":"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","sourcesContent":["// App.js\n\nimport React, { useState, useEffect } from 'react';\nimport useSocket from 'use-socket.io-client';\nimport { useImmer } from 'use-immer';\nimport './index.css';\nimport Navy from '../components/Navy'\nimport { useParams} from \"react-router-dom\";\nimport { saveHistory } from \"../utils/APIHistory\";\n\n\nconst Messages = props => props.data.map(m => m[0] !== '' ? (<li><strong>{m[0]}</strong> : <div className=\"innermsg\">{m[1]}</div></li>) : (<li className=\"update\">{m[1]}</li>));\n\nconst Online = props => props.data.map(m => <li id={m[0]}>{m[1]}</li>)\n\nexport default function Chat() {\n  const [id, setId] = useState('');\n  const [nameInput, setNameInput] = useState('');\n  const [room, setRoom] = useState('');\n  const [input, setInput] = useState('');\n\n  const [socket] = useSocket('https://open-chat-naostsaecf.now.sh');\n  socket.connect();\n\n  const [messages, setMessages] = useImmer([]);\n\n  const [online, setOnline] = useImmer([]);\n\n  //set room name based on props.match.params\n  const { vendorName } = useParams();\n  console.log(\"!!!!!! \",vendorName);\n\n  // on load, set room to be name of vendor, which came from useParams.\n  useEffect(() => {\n    setRoom(vendorName);\n  }, [])\n\n\n  // loads page history into db\n  saveHistory({\n    historytype: \"Chat Page\",\n    username:    vendorName,\n    detail:      `vendor name: ${vendorName}`,\n    date:        Date.now\n  })\n  .then().catch((err) => console.log(err))\n\n\n  useEffect(() => {\n    socket.on('message que', (nick, message) => {\n      setMessages(draft => {\n        draft.push([nick, message])\n      })\n    });\n\n    socket.on('update', message => setMessages(draft => {\n      draft.push(['', message]);\n    }))\n\n    socket.on('people-list', people => {\n      let newState = [];\n      for (let person in people) {\n        newState.push([people[person].id, people[person].nick]);\n      }\n      setOnline(draft => { draft.push(...newState) });\n      console.log(online)\n    });\n\n    socket.on('add-person', (nick, id) => {\n      setOnline(draft => {\n        draft.push([id, nick])\n      })\n    })\n\n    socket.on('remove-person', id => {\n      setOnline(draft => draft.filter(m => m[0] !== id))\n    })\n\n    socket.on('chat message', (nick, message) => {\n      setMessages(draft => { draft.push([nick, message]) })\n    })\n  }, 0);\n\n  const handleSubmit = e => {\n    e.preventDefault();\n    if (!nameInput) {\n      return alert(\"Name can't be empty\");\n    }\n    setId(nameInput);\n    socket.emit(\"join\", nameInput, room);\n  };\n\n  const handleSend = e => {\n    e.preventDefault();\n    if (input !== '') {\n      socket.emit('chat message', input, room);\n      setInput('');\n    }\n  }\n\n  return id ? (\n    <section style={{ display: 'flex', flexDirection: 'row' }} >\n      <ul id=\"messages\"><Messages data={messages} /></ul>\n      <ul id=\"online\"> <span role=\"img\" aria-label=\"sheep\">🌐</span> : <Online data={online} /> </ul>\n      <div id=\"sendform\">\n        <form onSubmit={e => handleSend(e)} style={{ display: 'flex' }}>\n          <input id=\"m\" onChange={e => setInput(e.target.value.trim())} /><button style={{ width: '75px' }} type=\"submit\">Send</button>\n        </form>\n      </div>\n    </section>\n  ) : (\n    //(conditional rendereing here possibly)\n      <div>\n        <Navy />\n        <div style={{ textAlign: 'center', margin: '30vh auto', width: '70%' }}>\n          {/* <img src={process.env.PUBLIC_URL + '/yellowchat-logo2.PNG'} /> */}\n          <h2>Chat with {room}</h2>\n          {/* //how to use the props? */}\n\n          <form onSubmit={event => handleSubmit(event)}>\n\n            <input id=\"name\" onChange={e => setNameInput(e.target.value.trim())} required placeholder=\"What is your name ..\" /><br />\n            {/* <input id=\"room\" onChange={e => setRoom(roomName)} placeholder=\"What is your room ..\" /><br /> */}\n            <button type=\"submit\">Submit</button>\n          </form>\n        </div>\n      </div>\n    );\n};\n\n"]},"metadata":{},"sourceType":"module"}